---
import BlogLayout from "../../layouts/blog.astro";
import { fetchBlocks, fetchPage, fetchPages } from "../../services/notion";
import Content from "../../components/Content";

const { id } = Astro.params;

const [post, blocks] = await Promise.all([fetchPage(id as string), fetchBlocks(id as string)]);

export async function getStaticPaths() {
  const pages = await fetchPages();
  // Get the paths we want to pre-render based on posts
  return pages.results.map(({ id }: { id: string }) => ({
    params: { id },
  }));
}
---

<BlogLayout
  id={post.id}
  frontmatter={{
    title: post.properties.Name.title[0].text.content,
    summary: post.properties.Summary.rich_text[0].text.content,
    publishedAt: new Date(post.properties["Published at"].date.start),
    updatedAt: new Date(post.last_edited_time),
  }}
>
  <Content client:visible blocks={blocks.results} />
</BlogLayout>
