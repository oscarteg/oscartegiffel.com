---
import { getCollection } from "astro:content";
import BlogPost from "../../components/BlogPost.astro";
import Body from "../../components/Body.astro";
import { filterPosts, groupBy, sortAsc } from "../../utils";

const posts = await getCollection("blog", filterPosts);
const reversedPosts = posts.sort(sortAsc);

const postsByYear = groupBy(reversedPosts, (post) => {
	const year = new Date(post.data.publishDate).getFullYear();
	return year.toString();
});

const sortedYears = Object.keys(postsByYear)
	.map((year) => Number(year))
	.sort((a, b) => b - a);
---

<Body title="Posts" description="A collection of my thoughts and ideas." toc={false}>
  {sortedYears.map((year, index) => {
    const yearKey = year.toString();
    return (
      <section class:list={[index < sortedYears.length - 1 ? "mb-16" : "mb-8"]}>
        <div class="flex items-center gap-4 mb-6">
          <h2 class="font-serif italic text-2xl text-text-muted opacity-60">{year}</h2>
          <div class="h-[1px] flex-1 bg-black/5 dark:bg-white/10"></div>
        </div>
        <div class="space-y-0">
          {postsByYear[yearKey]?.map((post) => (
            <BlogPost post={post} />
          ))}
        </div>
      </section>
    );
  })}
</Body>
