---
import { getCollection } from "astro:content";
import dayjs from "dayjs";
import BlogPost from "../../components/BlogPost.astro";
import DefaultLayout from "../../layouts/default.astro";
import type { Post } from "../../models";

const isProd = import.meta.env.PROD;
const posts = await getCollection("blog");
const filteredPosts = posts
  .filter(({ data }: Post) => (isProd ? !data.draft : true))
  .filter(({ data }) => (isProd ? dayjs(data.publishDate).isBefore(dayjs()) : true))
  .sort((a: Post, b: Post) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());
---

<DefaultLayout prose={false} title={"All Posts"}>
  <ul role="list" class="divide-y divide-gray-800">
    {filteredPosts.map((post: Post) => <BlogPost post={post} />)}
  </ul>
</DefaultLayout>
