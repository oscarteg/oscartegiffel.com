---
import DefaultLayout from "../../layouts/default.astro";

import { getCollection, getEntryBySlug } from "astro:content";
// 1. Get the slug from the incoming server request
const { slug } = Astro.params;

if (slug === undefined) {
  throw new Error("Slug is required");
}

// 2. Query for the entry directly using the request slug
const entry = await getEntryBySlug("blog", slug);

// 3. Redirect if the entry does not exist
if (entry === undefined) {
  return Astro.redirect("/404");
}
// 4. (Optional) Render the entry to HTML in the template
const { Content } = await entry.render();

export async function getStaticPaths() {
  const blogEntries = await getCollection("blog");
  return blogEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}
---

<DefaultLayout
  prose
  frontmatter={{
    title: entry.data.title,
    description: entry.data.summary,
  }}
>
  <Content />
</DefaultLayout>
